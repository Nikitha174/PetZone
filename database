-- 1. Create Behaviors Table
create table public.behaviors (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  pet_id bigint references public.pets(id) on delete cascade,
  issue text not null,
  date date not null,
  remedy text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Create Health Records Table
create table public.health_records (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  pet_id bigint references public.pets(id) on delete cascade,
  type text not null, -- Vaccination, Vet Visit, Checking, etc.
  title text,
  date date not null,
  next_due date,
  notes text,
  weight numeric,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Create Expenses Table
create table public.expenses (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  amount numeric not null,
  category text not null,
  date date not null,
  description text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. Enable RLS
alter table public.behaviors enable row level security;
alter table public.health_records enable row level security;
alter table public.expenses enable row level security;

-- 5. Policies for Behaviors
create policy "Users can view their own behaviors" on behaviors for select using (auth.uid() = user_id);
create policy "Users can insert their own behaviors" on behaviors for insert with check (auth.uid() = user_id);
create policy "Users can update their own behaviors" on behaviors for update using (auth.uid() = user_id);
create policy "Users can delete their own behaviors" on behaviors for delete using (auth.uid() = user_id);

-- 6. Policies for Health Records
create policy "Users can view their own health records" on health_records for select using (auth.uid() = user_id);
create policy "Users can insert their own health records" on health_records for insert with check (auth.uid() = user_id);
create policy "Users can update their own health records" on health_records for update using (auth.uid() = user_id);
create policy "Users can delete their own health records" on health_records for delete using (auth.uid() = user_id);

-- 7. Policies for Expenses
create policy "Users can view their own expenses" on expenses for select using (auth.uid() = user_id);
create policy "Users can insert their own expenses" on expenses for insert with check (auth.uid() = user_id);
create policy "Users can update their own expenses" on expenses for update using (auth.uid() = user_id);
create policy "Users can delete their own expenses" on expenses for delete using (auth.uid() = user_id);
